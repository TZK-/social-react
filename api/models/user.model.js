const mongoose = require('mongoose');

// TODO keep until we have avatar support
const colors = [
    '1ba39c', '1ba39c', '1ba39c', '00aa55', '1ba39c', '03a678', '00aa00', '26a65b', '00a566', '16a085', '5d995d', '24a159', '28a228', '019875', '6b8e23', '049372', '008b8b', '2e8b57', '2e8856', '40806a', '1e824c', '4b7b4b', '5a781d', '008040', '007a7c', '008000', '007a4b', '1b7742', '1d781d', '436e43', '4b6319', '006060', '20603c', '345a5e', '205e3b', '2a5547', '005555', '315131', '00552a', '005500', '3a4d13', '005031', '134d13', '114c2a', '294429', '2b390e', '003636', '123622', '113321', '152a23', '002a15', '002a00', '172617', '002627', '1a2309', '002517', '082213', '00a4a6', '3498db', '638bb3', '6d8891', '1e8bc3', '4183d7', '527ac2', '3477db', '4b77be', '1978d4', '2a7ab0', '008080', '2574a9', '336e7b', '406098', '3455db', '1460aa', '006080', '205d86', '3a539b', '34495e', '005051', '2e456d', '34415e', '2c3e50', '16405b', '34385e', '0000e0', '004055', '2d383c', '0000b5', '0a3055', '1c2a43', '252a2a', '002a2a', '00008b', '0c2231', '00202a', '000060', '05182a', '000036', 'b381b3', 'e26a6a', 'd252b2', '9370db', 'd25299', 'd25852', 'e73c70', 'd25265', 'e000e0', 'b659ac', 'ae59b6', 'd400d4', '9b59b6', '7462e0', '886288', 'db0a5b', '8859b6', '7659b6', '765ab0', 'a74165', '9932cc', 'b500b5', '8e44ad', '8a2be2', 'aa00aa', '913d88', '5e50b5', '9400d3', '9a12b3', '77448b', '5a4586', '7928a1', '674172', '7023b7', '8b008b', '663399', '5d445d', '7d314c', '7600a8', '483d8b', '800080', '561b8d', '591d77', '58007e', '600060', '522032', '322a60', '550055', '3c1362', '332533', '39134c', '3b0053', '2e1b36', '360036', '211931', '1c1836', '220b38', '2a002a', '1d0029', '939393', '808080', '7e7e7e', '708090', '708080', '6c7a89', '696969', '4b6a88', '4d6066', '555555', '545454', '4b5555', '34515e', '3e3e3e', '2e343b', '2b2b2b', '2a2a2a', '292929', '1c2833', '050709', '000000', 'b8860b', '9d8319', '807d67', '8d6708', '806c00', '856514', '726012', '555344', '634806', '554800', '5a440d', '483c0c', '382903', '2a2a22', '302407', '2a2400', '1d1905', 'd47500', 'd46a43', 'e65722', 'bb671c', 'd35400', 'aa6b51', 'e63022', 'd43900', 'aa5d00', 'aa5535', '80503d', 'aa2e00', '744e2e', '804600', '804028', '802200', '553529', '4a321d', '552a1b', '551700', '3c2109', '2a150d', 'e76e3c', 'e74c3c', 'd4533b', 'e73c4e', 'd24d57', 'd64541', 'dc2a2a', 'dc143c', 'e00000', 'd91e18', 'bc3e31', 'c0392b', 'd50000', 'b22222', 'b50000', 'b11030', 'aa0000', '923026', '96281b', '803224', '871a1a', '8b0000', '870c25', '800000', '67221b', '552118', '5d1212', '600000', '5c0819', '550000', '3d1410', '360000', '320a0a', '32050e', '2b0000'
];

const schema = new mongoose.Schema({
    email: {
        type: String,
        unique: true,
        required: true
    },
    first_name: {
        type: String,
        required: true
    },
    last_name: {
        type: String,
        required: true
    },
    password: {
        type: String,
        required: true,
        select: false
    },
    friends: [{
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Friend'
    }]
}, {timestamp: true});

schema.pre('init', (user) => {
    const color = colors[parseInt(user._id.valueOf(), 16) % colors.length];
    user.avatar = `https://ui-avatars.com/api/?background=${color}&color=fff&name=${user.first_name} ${user.last_name}`
});

schema.set('toJSON', {virtuals: true});

module.exports = mongoose.model('User', schema);
